# Comparing `tmp/kaiju_tools-2.0.50-py3-none-any.whl.zip` & `tmp/kaiju_tools-2.0.51-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,104 +1,104 @@
-Zip file size: 119976 bytes, number of entries: 102
--rw-r--r--  2.0 unx     3424 b- defN 23-Apr-22 16:48 kaiju_tools/CLI.py
--rw-r--r--  2.0 unx      228 b- defN 23-Apr-22 16:48 kaiju_tools/__init__.py
--rw-r--r--  2.0 unx     7473 b- defN 23-Apr-22 16:48 kaiju_tools/class_registry.py
--rw-r--r--  2.0 unx     6013 b- defN 23-Apr-22 16:48 kaiju_tools/exceptions.py
--rw-r--r--  2.0 unx      997 b- defN 23-Apr-22 16:48 kaiju_tools/fixtures.py
--rw-r--r--  2.0 unx     8965 b- defN 23-Apr-22 16:48 kaiju_tools/functions.py
--rw-r--r--  2.0 unx     2172 b- defN 23-Apr-22 16:48 kaiju_tools/init_app.py
--rw-r--r--  2.0 unx    19143 b- defN 23-Apr-22 16:48 kaiju_tools/jsonschema.py
--rw-r--r--  2.0 unx      195 b- defN 23-Apr-22 16:48 kaiju_tools/loop.py
--rw-r--r--  2.0 unx    13521 b- defN 23-Apr-22 16:48 kaiju_tools/mapping.py
--rw-r--r--  2.0 unx      159 b- defN 23-Apr-22 16:48 kaiju_tools/serialization.py
--rw-r--r--  2.0 unx     8221 b- defN 23-Apr-22 16:48 kaiju_tools/services.py
--rw-r--r--  2.0 unx    14345 b- defN 23-Apr-22 16:48 kaiju_tools/templates.py
--rw-r--r--  2.0 unx     4793 b- defN 23-Apr-22 16:48 kaiju_tools/ttl_dict.py
--rw-r--r--  2.0 unx     3691 b- defN 23-Apr-22 16:48 kaiju_tools/types.py
--rw-r--r--  2.0 unx     2595 b- defN 23-Apr-22 16:48 kaiju_tools/cache/__init__.py
--rw-r--r--  2.0 unx    10481 b- defN 23-Apr-22 16:48 kaiju_tools/cache/abc.py
--rw-r--r--  2.0 unx     2373 b- defN 23-Apr-22 16:48 kaiju_tools/cache/local_cache.py
--rw-r--r--  2.0 unx       43 b- defN 23-Apr-22 16:48 kaiju_tools/cache/services.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/cache/tests/__init__.py
--rw-r--r--  2.0 unx     2315 b- defN 23-Apr-22 16:48 kaiju_tools/cache/tests/test_cache.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/commands/__init__.py
--rw-r--r--  2.0 unx      932 b- defN 23-Apr-22 16:48 kaiju_tools/config/__init__.py
--rw-r--r--  2.0 unx     7661 b- defN 23-Apr-22 16:48 kaiju_tools/config/config_loader.py
--rw-r--r--  2.0 unx     2975 b- defN 23-Apr-22 16:48 kaiju_tools/config/configurator.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/config/tests/__init__.py
--rw-r--r--  2.0 unx      586 b- defN 23-Apr-22 16:48 kaiju_tools/config/tests/test_configurator.py
--rw-r--r--  2.0 unx      276 b- defN 23-Apr-22 16:48 kaiju_tools/docker/__init__.py
--rw-r--r--  2.0 unx     9769 b- defN 23-Apr-22 16:48 kaiju_tools/docker/containers.py
--rw-r--r--  2.0 unx     7728 b- defN 23-Apr-22 16:48 kaiju_tools/docker/images.py
--rw-r--r--  2.0 unx      103 b- defN 23-Apr-22 16:48 kaiju_tools/docker/services.py
--rw-r--r--  2.0 unx    11140 b- defN 23-Apr-22 16:48 kaiju_tools/docker/stack.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/docker/tests/__init__.py
--rw-r--r--  2.0 unx     1625 b- defN 23-Apr-22 16:48 kaiju_tools/docker/tests/fixtures.py
--rw-r--r--  2.0 unx      575 b- defN 23-Apr-22 16:48 kaiju_tools/docker/tests/test_containers.py
--rw-r--r--  2.0 unx      359 b- defN 23-Apr-22 16:48 kaiju_tools/docker/tests/test_images.py
--rw-r--r--  2.0 unx      371 b- defN 23-Apr-22 16:48 kaiju_tools/docker/tests/test_stack.py
--rw-r--r--  2.0 unx       65 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/__init__.py
--rw-r--r--  2.0 unx     2996 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/abc.py
--rw-r--r--  2.0 unx      163 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/etc.py
--rw-r--r--  2.0 unx     4457 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/json.py
--rw-r--r--  2.0 unx     4284 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/msgpack.py
--rw-r--r--  2.0 unx      654 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/serializers.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/tests/__init__.py
--rw-r--r--  2.0 unx      780 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/tests/fixtures.py
--rw-r--r--  2.0 unx     1054 b- defN 23-Apr-22 16:48 kaiju_tools/encoding/tests/test_serializers.py
--rw-r--r--  2.0 unx       46 b- defN 23-Apr-22 16:48 kaiju_tools/es/__init__.py
--rw-r--r--  2.0 unx    18302 b- defN 23-Apr-22 16:48 kaiju_tools/es/client.py
--rw-r--r--  2.0 unx     5559 b- defN 23-Apr-22 16:48 kaiju_tools/es/loader.py
--rw-r--r--  2.0 unx    17588 b- defN 23-Apr-22 16:48 kaiju_tools/es/schema.py
--rw-r--r--  2.0 unx       66 b- defN 23-Apr-22 16:48 kaiju_tools/es/services.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/es/tests/__init__.py
--rw-r--r--  2.0 unx       32 b- defN 23-Apr-22 16:48 kaiju_tools/http/__init__.py
--rw-r--r--  2.0 unx     6007 b- defN 23-Apr-22 16:48 kaiju_tools/http/client.py
--rw-r--r--  2.0 unx      932 b- defN 23-Apr-22 16:48 kaiju_tools/http/middlewares.py
--rw-r--r--  2.0 unx     3692 b- defN 23-Apr-22 16:48 kaiju_tools/http/views.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/http/tests/__init__.py
--rw-r--r--  2.0 unx     1532 b- defN 23-Apr-22 16:48 kaiju_tools/http/tests/test_client.py
--rw-r--r--  2.0 unx     2392 b- defN 23-Apr-22 16:48 kaiju_tools/http/tests/test_rpc_rest_view.py
--rw-r--r--  2.0 unx     2344 b- defN 23-Apr-22 16:48 kaiju_tools/locks/__init__.py
--rw-r--r--  2.0 unx     9351 b- defN 23-Apr-22 16:48 kaiju_tools/locks/abc.py
--rw-r--r--  2.0 unx      393 b- defN 23-Apr-22 16:48 kaiju_tools/locks/etc.py
--rw-r--r--  2.0 unx      284 b- defN 23-Apr-22 16:48 kaiju_tools/locks/exceptions.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/locks/tests/__init__.py
--rw-r--r--  2.0 unx     1913 b- defN 23-Apr-22 16:48 kaiju_tools/locks/tests/test_locks.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/logging/__init__.py
--rw-r--r--  2.0 unx     3355 b- defN 23-Apr-22 16:48 kaiju_tools/logging/services.py
--rw-r--r--  2.0 unx    10173 b- defN 23-Apr-22 16:48 kaiju_tools/logging/types.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/logging/tests/__init__.py
--rw-r--r--  2.0 unx     1827 b- defN 23-Apr-22 16:48 kaiju_tools/logging/tests/test_loggers.py
--rw-r--r--  2.0 unx       43 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/__init__.py
--rw-r--r--  2.0 unx    11883 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/abc.py
--rw-r--r--  2.0 unx     5111 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/client.py
--rw-r--r--  2.0 unx     3825 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/client_gen.py
--rw-r--r--  2.0 unx      116 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/context.py
--rw-r--r--  2.0 unx      544 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/etc.py
--rw-r--r--  2.0 unx     2943 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/jsonrpc.py
--rw-r--r--  2.0 unx    21814 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/server.py
--rw-r--r--  2.0 unx       71 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/services.py
--rw-r--r--  2.0 unx     6259 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/sessions.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/tests/__init__.py
--rw-r--r--  2.0 unx     4207 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/tests/fixtures.py
--rw-r--r--  2.0 unx     7845 b- defN 23-Apr-22 16:48 kaiju_tools/rpc/tests/test_rpc_server.py
--rw-r--r--  2.0 unx       38 b- defN 23-Apr-22 16:48 kaiju_tools/streams/__init__.py
--rw-r--r--  2.0 unx    24578 b- defN 23-Apr-22 16:48 kaiju_tools/streams/abc.py
--rw-r--r--  2.0 unx      152 b- defN 23-Apr-22 16:48 kaiju_tools/streams/etc.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/streams/tests/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/streams/tests/fixtures.py
--rw-r--r--  2.0 unx     5975 b- defN 23-Apr-22 16:48 kaiju_tools/streams/tests/test_streams.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-22 16:48 kaiju_tools/tests/__init__.py
--rw-r--r--  2.0 unx     2016 b- defN 23-Apr-22 16:48 kaiju_tools/tests/fixtures.py
--rw-r--r--  2.0 unx     1408 b- defN 23-Apr-22 16:48 kaiju_tools/tests/test_class_registry.py
--rw-r--r--  2.0 unx     3385 b- defN 23-Apr-22 16:48 kaiju_tools/tests/test_mapping.py
--rw-r--r--  2.0 unx      481 b- defN 23-Apr-22 16:48 kaiju_tools/tests/test_serialization.py
--rw-r--r--  2.0 unx     2787 b- defN 23-Apr-22 16:48 kaiju_tools/tests/test_services.py
--rw-r--r--  2.0 unx     1554 b- defN 23-Apr-22 16:48 kaiju_tools/tests/test_templates.py
--rw-r--r--  2.0 unx      796 b- defN 23-Apr-22 16:48 kaiju_tools/tests/test_ttl_dict.py
--rw-rw-rw-  2.0 unx      610 b- defN 23-Apr-22 16:48 kaiju_tools-2.0.50.dist-info/LICENSE
--rw-r--r--  2.0 unx     3258 b- defN 23-Apr-22 16:48 kaiju_tools-2.0.50.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-22 16:48 kaiju_tools-2.0.50.dist-info/WHEEL
--rw-r--r--  2.0 unx       12 b- defN 23-Apr-22 16:48 kaiju_tools-2.0.50.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     8820 b- defN 23-Apr-22 16:48 kaiju_tools-2.0.50.dist-info/RECORD
-102 files, 376111 bytes uncompressed, 105934 bytes compressed:  71.8%
+Zip file size: 119904 bytes, number of entries: 102
+-rw-r--r--  2.0 unx     3424 b- defN 23-Apr-24 11:58 kaiju_tools/CLI.py
+-rw-r--r--  2.0 unx      228 b- defN 23-Apr-24 11:58 kaiju_tools/__init__.py
+-rw-r--r--  2.0 unx     7473 b- defN 23-Apr-24 11:58 kaiju_tools/class_registry.py
+-rw-r--r--  2.0 unx     6013 b- defN 23-Apr-24 11:58 kaiju_tools/exceptions.py
+-rw-r--r--  2.0 unx      997 b- defN 23-Apr-24 11:58 kaiju_tools/fixtures.py
+-rw-r--r--  2.0 unx     8940 b- defN 23-Apr-24 11:58 kaiju_tools/functions.py
+-rw-r--r--  2.0 unx     2172 b- defN 23-Apr-24 11:58 kaiju_tools/init_app.py
+-rw-r--r--  2.0 unx    19143 b- defN 23-Apr-24 11:58 kaiju_tools/jsonschema.py
+-rw-r--r--  2.0 unx      195 b- defN 23-Apr-24 11:58 kaiju_tools/loop.py
+-rw-r--r--  2.0 unx    13521 b- defN 23-Apr-24 11:58 kaiju_tools/mapping.py
+-rw-r--r--  2.0 unx      159 b- defN 23-Apr-24 11:58 kaiju_tools/serialization.py
+-rw-r--r--  2.0 unx     8221 b- defN 23-Apr-24 11:58 kaiju_tools/services.py
+-rw-r--r--  2.0 unx    14345 b- defN 23-Apr-24 11:58 kaiju_tools/templates.py
+-rw-r--r--  2.0 unx     3442 b- defN 23-Apr-24 11:58 kaiju_tools/ttl_dict.py
+-rw-r--r--  2.0 unx     3691 b- defN 23-Apr-24 11:58 kaiju_tools/types.py
+-rw-r--r--  2.0 unx     2595 b- defN 23-Apr-24 11:58 kaiju_tools/cache/__init__.py
+-rw-r--r--  2.0 unx    10481 b- defN 23-Apr-24 11:58 kaiju_tools/cache/abc.py
+-rw-r--r--  2.0 unx     2373 b- defN 23-Apr-24 11:58 kaiju_tools/cache/local_cache.py
+-rw-r--r--  2.0 unx       43 b- defN 23-Apr-24 11:58 kaiju_tools/cache/services.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/cache/tests/__init__.py
+-rw-r--r--  2.0 unx     2315 b- defN 23-Apr-24 11:58 kaiju_tools/cache/tests/test_cache.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/commands/__init__.py
+-rw-r--r--  2.0 unx      932 b- defN 23-Apr-24 11:58 kaiju_tools/config/__init__.py
+-rw-r--r--  2.0 unx     7661 b- defN 23-Apr-24 11:58 kaiju_tools/config/config_loader.py
+-rw-r--r--  2.0 unx     2975 b- defN 23-Apr-24 11:58 kaiju_tools/config/configurator.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/config/tests/__init__.py
+-rw-r--r--  2.0 unx      586 b- defN 23-Apr-24 11:58 kaiju_tools/config/tests/test_configurator.py
+-rw-r--r--  2.0 unx      276 b- defN 23-Apr-24 11:58 kaiju_tools/docker/__init__.py
+-rw-r--r--  2.0 unx     9769 b- defN 23-Apr-24 11:58 kaiju_tools/docker/containers.py
+-rw-r--r--  2.0 unx     7728 b- defN 23-Apr-24 11:58 kaiju_tools/docker/images.py
+-rw-r--r--  2.0 unx      103 b- defN 23-Apr-24 11:58 kaiju_tools/docker/services.py
+-rw-r--r--  2.0 unx    11140 b- defN 23-Apr-24 11:58 kaiju_tools/docker/stack.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/docker/tests/__init__.py
+-rw-r--r--  2.0 unx     1625 b- defN 23-Apr-24 11:58 kaiju_tools/docker/tests/fixtures.py
+-rw-r--r--  2.0 unx      575 b- defN 23-Apr-24 11:58 kaiju_tools/docker/tests/test_containers.py
+-rw-r--r--  2.0 unx      359 b- defN 23-Apr-24 11:58 kaiju_tools/docker/tests/test_images.py
+-rw-r--r--  2.0 unx      371 b- defN 23-Apr-24 11:58 kaiju_tools/docker/tests/test_stack.py
+-rw-r--r--  2.0 unx       65 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/__init__.py
+-rw-r--r--  2.0 unx     3012 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/abc.py
+-rw-r--r--  2.0 unx      163 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/etc.py
+-rw-r--r--  2.0 unx     4456 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/json.py
+-rw-r--r--  2.0 unx     4284 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/msgpack.py
+-rw-r--r--  2.0 unx      654 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/serializers.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/tests/__init__.py
+-rw-r--r--  2.0 unx      780 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/tests/fixtures.py
+-rw-r--r--  2.0 unx     1054 b- defN 23-Apr-24 11:58 kaiju_tools/encoding/tests/test_serializers.py
+-rw-r--r--  2.0 unx       46 b- defN 23-Apr-24 11:58 kaiju_tools/es/__init__.py
+-rw-r--r--  2.0 unx    18302 b- defN 23-Apr-24 11:58 kaiju_tools/es/client.py
+-rw-r--r--  2.0 unx     5559 b- defN 23-Apr-24 11:58 kaiju_tools/es/loader.py
+-rw-r--r--  2.0 unx    17588 b- defN 23-Apr-24 11:58 kaiju_tools/es/schema.py
+-rw-r--r--  2.0 unx       66 b- defN 23-Apr-24 11:58 kaiju_tools/es/services.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/es/tests/__init__.py
+-rw-r--r--  2.0 unx       32 b- defN 23-Apr-24 11:58 kaiju_tools/http/__init__.py
+-rw-r--r--  2.0 unx     6007 b- defN 23-Apr-24 11:58 kaiju_tools/http/client.py
+-rw-r--r--  2.0 unx      932 b- defN 23-Apr-24 11:58 kaiju_tools/http/middlewares.py
+-rw-r--r--  2.0 unx     3692 b- defN 23-Apr-24 11:58 kaiju_tools/http/views.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/http/tests/__init__.py
+-rw-r--r--  2.0 unx     1532 b- defN 23-Apr-24 11:58 kaiju_tools/http/tests/test_client.py
+-rw-r--r--  2.0 unx     2392 b- defN 23-Apr-24 11:58 kaiju_tools/http/tests/test_rpc_rest_view.py
+-rw-r--r--  2.0 unx     2344 b- defN 23-Apr-24 11:58 kaiju_tools/locks/__init__.py
+-rw-r--r--  2.0 unx     9351 b- defN 23-Apr-24 11:58 kaiju_tools/locks/abc.py
+-rw-r--r--  2.0 unx      393 b- defN 23-Apr-24 11:58 kaiju_tools/locks/etc.py
+-rw-r--r--  2.0 unx      284 b- defN 23-Apr-24 11:58 kaiju_tools/locks/exceptions.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/locks/tests/__init__.py
+-rw-r--r--  2.0 unx     1913 b- defN 23-Apr-24 11:58 kaiju_tools/locks/tests/test_locks.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/logging/__init__.py
+-rw-r--r--  2.0 unx     3355 b- defN 23-Apr-24 11:58 kaiju_tools/logging/services.py
+-rw-r--r--  2.0 unx    10173 b- defN 23-Apr-24 11:58 kaiju_tools/logging/types.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/logging/tests/__init__.py
+-rw-r--r--  2.0 unx     1827 b- defN 23-Apr-24 11:58 kaiju_tools/logging/tests/test_loggers.py
+-rw-r--r--  2.0 unx       43 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/__init__.py
+-rw-r--r--  2.0 unx    11883 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/abc.py
+-rw-r--r--  2.0 unx     5111 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/client.py
+-rw-r--r--  2.0 unx     3825 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/client_gen.py
+-rw-r--r--  2.0 unx      116 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/context.py
+-rw-r--r--  2.0 unx      591 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/etc.py
+-rw-r--r--  2.0 unx     2943 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/jsonrpc.py
+-rw-r--r--  2.0 unx    23056 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/server.py
+-rw-r--r--  2.0 unx       71 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/services.py
+-rw-r--r--  2.0 unx     6259 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/sessions.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/tests/__init__.py
+-rw-r--r--  2.0 unx     4655 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/tests/fixtures.py
+-rw-r--r--  2.0 unx     8500 b- defN 23-Apr-24 11:58 kaiju_tools/rpc/tests/test_rpc_server.py
+-rw-r--r--  2.0 unx       38 b- defN 23-Apr-24 11:58 kaiju_tools/streams/__init__.py
+-rw-r--r--  2.0 unx    24578 b- defN 23-Apr-24 11:58 kaiju_tools/streams/abc.py
+-rw-r--r--  2.0 unx      152 b- defN 23-Apr-24 11:58 kaiju_tools/streams/etc.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/streams/tests/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/streams/tests/fixtures.py
+-rw-r--r--  2.0 unx     5975 b- defN 23-Apr-24 11:58 kaiju_tools/streams/tests/test_streams.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-24 11:58 kaiju_tools/tests/__init__.py
+-rw-r--r--  2.0 unx     2016 b- defN 23-Apr-24 11:58 kaiju_tools/tests/fixtures.py
+-rw-r--r--  2.0 unx     1408 b- defN 23-Apr-24 11:58 kaiju_tools/tests/test_class_registry.py
+-rw-r--r--  2.0 unx     3385 b- defN 23-Apr-24 11:58 kaiju_tools/tests/test_mapping.py
+-rw-r--r--  2.0 unx      481 b- defN 23-Apr-24 11:58 kaiju_tools/tests/test_serialization.py
+-rw-r--r--  2.0 unx     2787 b- defN 23-Apr-24 11:58 kaiju_tools/tests/test_services.py
+-rw-r--r--  2.0 unx     1692 b- defN 23-Apr-24 11:58 kaiju_tools/tests/test_templates.py
+-rw-r--r--  2.0 unx      796 b- defN 23-Apr-24 11:58 kaiju_tools/tests/test_ttl_dict.py
+-rw-rw-rw-  2.0 unx      610 b- defN 23-Apr-24 11:59 kaiju_tools-2.0.51.dist-info/LICENSE
+-rw-r--r--  2.0 unx     3258 b- defN 23-Apr-24 11:59 kaiju_tools-2.0.51.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-24 11:59 kaiju_tools-2.0.51.dist-info/WHEEL
+-rw-r--r--  2.0 unx       12 b- defN 23-Apr-24 11:59 kaiju_tools-2.0.51.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     8820 b- defN 23-Apr-24 11:59 kaiju_tools-2.0.51.dist-info/RECORD
+102 files, 377280 bytes uncompressed, 105862 bytes compressed:  71.9%
```

## zipnote {}

```diff
@@ -285,23 +285,23 @@
 
 Filename: kaiju_tools/tests/test_templates.py
 Comment: 
 
 Filename: kaiju_tools/tests/test_ttl_dict.py
 Comment: 
 
-Filename: kaiju_tools-2.0.50.dist-info/LICENSE
+Filename: kaiju_tools-2.0.51.dist-info/LICENSE
 Comment: 
 
-Filename: kaiju_tools-2.0.50.dist-info/METADATA
+Filename: kaiju_tools-2.0.51.dist-info/METADATA
 Comment: 
 
-Filename: kaiju_tools-2.0.50.dist-info/WHEEL
+Filename: kaiju_tools-2.0.51.dist-info/WHEEL
 Comment: 
 
-Filename: kaiju_tools-2.0.50.dist-info/top_level.txt
+Filename: kaiju_tools-2.0.51.dist-info/top_level.txt
 Comment: 
 
-Filename: kaiju_tools-2.0.50.dist-info/RECORD
+Filename: kaiju_tools-2.0.51.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## kaiju_tools/__init__.py

```diff
@@ -2,10 +2,10 @@
 from .http import *
 from .rpc import *
 from .es import *
 from .cache import *
 from .locks import *
 from .streams import *
 
-__version__ = '2.0.50'
+__version__ = '2.0.51'
 __python_version__ = '3.8'
 __author__ = 'antonnidhoggr@me.com'
```

## kaiju_tools/functions.py

```diff
@@ -140,15 +140,15 @@
                 async with timeout(exec_timeout):
                     result = await func(*args, **kws)
             else:
                 result = await func(*args, **kws)
         except Exception as err:
             if err.__class__.__name__ in exception_classes_names:
                 if logger:
-                    logger.info('Retrying because of: %s', err, exc_info=err)
+                    logger.info('Retrying: %s', err)
                 exc = err
                 await sleep(retry_timeout)
                 retry_timeout = min(max_retry_timeout, retry_timeout * modifier)
                 retries -= 1
                 continue
             raise
```

## kaiju_tools/ttl_dict.py

```diff
@@ -1,75 +1,14 @@
-"""
-A simple mutable mapping that supports TTL.
-
-It can be used for arbitrary data caching. TTL value is global for all the
-objects. If you need more complex TTL behaviour, use specialized cache solutions
-like Redis.
-
-Basic use is the same as for a dictionary object.
-
-.. code-block:: python
-
-    cache = TTLDict({'sht': 666})
-    assert 'sht' in cache
-    assert cache['sht'] == 666
-    del d['sht']
-
-Objects surpassed their TTL are stored until some action is performed
-(like counting length, accessing keys or values, etc.)
-
-.. code-block:: python
-
-    cache = TTLDict({'sht': 666})
-    cache.set_ttl(1)
-    sleep(3)
-
-    # 'sht' is still in the cache but if you try to access it, it will be pruned
-    # you can directly call refresh to free some memory manually
-
-    cache.refresh()
-
-
-Performance
------------
-
-Here is performance data for different operations and different number of keys.
-Number of operations per second and relative performance compared to a normal `dict`.
-
-.. code-block::
-
-    2020-01-24
-    Intel(R) Core(TM) i5-7360U CPU @ 2.30GHz
-    Testing TTL dict performance (3000 cycles, 3 runs)...
-
-GET:
-  10    1524277 sec^-1 | 15.0%
- 100     727588 sec^-1 | 6.8%
-1000     132112 sec^-1 | 1.4%
-
-SET:
-  10     579831 sec^-1 | 12.0%
- 100     317694 sec^-1 | 6.8%
-1000     193648 sec^-1 | 4.5%
-
-LENGTH:
-  10    1413810 sec^-1 | 18.0%
- 100    1254652 sec^-1 | 16.6%
-1000    1177403 sec^-1 | 17.0%
-
-
-Classes
--------
-
-"""
+"""A simple mutable mapping what supports TTL."""
 
 import bisect
 import sys
 from collections.abc import MutableMapping
 from time import time
+from typing import cast
 
 __all__ = ['TTLDict']
 
 
 class TTLDict(MutableMapping):
     """A simple TTL dict mostly compatible with a normal one."""
 
@@ -125,25 +64,26 @@
         """Similar to `dict().get`."""
         try:
             return self[item]
         except KeyError:
             return default
 
     def set(self, key, value, ttl: int):
-        """
+        """Set key.
+
         Similar to `__setitem__` but you may specify per-key ttl.
         """
         if key in self._dict:
             del self[key]
             self.set(key, value, ttl)
         else:
             if ttl:
                 t = int(time() + ttl)
             else:
-                t = float('Inf')
+                t = cast(int, float('Inf'))
             n = bisect.bisect_left(self._ttls, t)
             self._ttls.insert(n, t)
             self._keys.insert(n, key)
             self._dict[key] = value
 
     def values(self):
         """Similar to `dict().values`."""
@@ -156,28 +96,27 @@
         return self._dict.keys()
 
     def items(self):
         """Similar to `dict().items`."""
         return zip(self._dict.keys(), self.values())
 
     def set_ttl(self, ttl: int):
-        """
-        Set default ttl to a new value
+        """Set default ttl to a new value.
 
         :param ttl: TTL value in seconds
         """
         if not ttl:
             ttl = sys.maxsize
         elif ttl < 0:
             raise ValueError('TTL value must be greater than zero.')
         ttl = int(ttl)
         self._ttl = ttl
 
     def refresh(self):
-        """Removes old records.
+        """Remove old records.
 
         .. note::
 
             This method is called each time one calls a `TTLDict.__len__`
             or any other method that must provide an actual dictionary state.
 
         """
```

## kaiju_tools/encoding/abc.py

```diff
@@ -32,15 +32,15 @@
                         continue
                     if not k.startswith('_'):
                         if isinstance(v, Serializable):
                             _repr[k] = v.repr()
                         else:
                             _repr[k] = v
         else:
-            if self.__slots__:
+            if self.__slots__:  # type: ignore
                 for slot in self.__slots__:
                     if slot in self.serializable_attrs and hasattr(self, slot):
                         v = getattr(self, slot)
                         if not self.include_null_values and v is None:
                             continue
                         if isinstance(v, Serializable):
                             _repr[slot] = v.repr()
```

## kaiju_tools/encoding/json.py

```diff
@@ -1,12 +1,12 @@
 from collections.abc import Mapping
 from enum import Enum
 from types import SimpleNamespace
 
-import rapidjson as rj  # noqa pycharm?
+import rapidjson as rj  # type: ignore
 
 from .abc import SerializerInterface, Serializable
 from .etc import MimeTypes
 
 __all__ = ('dumps', 'dumps_bytes', 'loads', 'load', 'Serializer')
```

## kaiju_tools/rpc/etc.py

```diff
@@ -1,17 +1,22 @@
 __all__ = ('JSONRPCHeaders',)
 
 
 class JSONRPCHeaders:
     """List of JSONRPC request / response headers."""
 
-    APP_ID_HEADER = 'X-App-Id'
-    CORRELATION_ID_HEADER = 'X-Correlation-Id'
-    ABORT_ON_ERROR = 'X-Abort-On-Error'
-    SERVER_ID_HEADER = 'X-Server-Id'
-    REQUEST_DEADLINE_HEADER = 'X-Request-Deadline'
-    REQUEST_TIMEOUT_HEADER = 'X-Request-Timeout'
+    AUTHORIZATION = 'Authorization'
     CONTENT_TYPE_HEADER = 'Content-Type'
-    SESSION_ID_HEADER = 'X-Session-Id'
     USER_AGENT = 'User-Agent'
-    CALLBACK_ID = 'X-Callback-Id'
-    AUTHORIZATION = 'Authorization'
+
+    APP_ID_HEADER = 'App-Id'
+    SERVER_ID_HEADER = 'Server-Id'
+    CORRELATION_ID_HEADER = 'Correlation-Id'
+
+    REQUEST_DEADLINE_HEADER = 'Deadline'
+    REQUEST_TIMEOUT_HEADER = 'Timeout'
+    RETRIES = 'RPC-Retries'
+    CALLBACK_ID = 'RPC-Callback'
+    ABORT_ON_ERROR = 'RPC-Batch-Abort-Error'
+    USE_TEMPLATE = 'RPC-Batch-Template'
+
+    SESSION_ID_HEADER = 'Session-Id'
```

## kaiju_tools/rpc/server.py

```diff
@@ -10,15 +10,16 @@
 
 import fastjsonschema  # type: ignore
 
 from kaiju_tools.rpc.abc import AbstractRPCCompatible
 from kaiju_tools.rpc.etc import JSONRPCHeaders
 from kaiju_tools.rpc.sessions import BaseSessionService
 from kaiju_tools.rpc.jsonrpc import RPCError, RPCResponse, JSONRPC
-from kaiju_tools.functions import timeout
+from kaiju_tools.functions import timeout, retry
+from kaiju_tools.templates import Template
 from kaiju_tools.exceptions import (
     APIException,
     RequestTimeout,
     InternalError,
     InvalidRequest,
     InvalidParams,
     Aborted,
@@ -48,14 +49,16 @@
 
 class RequestHeaders(TypedDict):
     """Request headers acknowledged by the server."""
 
     correlation_id: str
     request_deadline: int
     abort_on_error: bool
+    use_template: bool
+    retries: int
 
 
 class MethodInfo(TypedDict):
     """Stored method data."""
 
     f: Callable
     signature: List[str]
@@ -269,31 +272,35 @@
                 reqs = [self._prepare_request(req, session, scope, n) for n, req in enumerate(body)]
                 return_result = any((req[0] is not None for req in reqs))
             except JSONRPCError as exc:
                 headers = self._get_response_headers(headers['correlation_id'], session)
                 return headers, RPCError(id=exc.data.get('id'), error=exc)
             coro = self._execute_batch(
                 reqs,
+                retries=headers['retries'],
                 request_deadline=headers['request_deadline'],
                 abort_on_error=headers['abort_on_error'],
+                use_template=headers['use_template'],
                 session=session,
                 correlation_id=headers['correlation_id'],
                 callback=callback,
             )
         else:
             try:
-                req_id, coro, body = self._prepare_request(body, session, scope, 0)
+                req_id, f, params, body = self._prepare_request(body, session, scope, 0)
                 return_result = req_id is not None
             except JSONRPCError as exc:
                 headers = self._get_response_headers(headers['correlation_id'], session)
                 return headers, RPCError(id=exc.data.get('id'), error=exc)
             coro = self._execute_single(
-                coro,
+                f,
+                params,
                 request_id=req_id,
                 body=body,
+                retries=headers['retries'],
                 request_deadline=headers['request_deadline'],
                 session=session,
                 correlation_id=headers['correlation_id'],
                 callback=callback,
             )
         self._counter -= 1
         if not self._not_full.is_set():
@@ -312,70 +319,79 @@
             return self._get_response_headers(headers['correlation_id'], session), None
         elif nowait:
             return task
         else:
             return await task
 
     @staticmethod
-    def _parse_number_value(value, min_val, max_val, default) -> int:
-        if not value:
-            return default
+    def _get_int_header(value: Union[str, None], default) -> int:
+        """Parse an integer header value.
+
+        https://httpwg.org/specs/rfc8941.html#integer
+        """
         try:
-            value = int(value)
-        except Exception:  # noqa
+            return int(value) if value else default
+        except ValueError:
             return default
-        return min(max(min_val, value), max_val)
 
     @staticmethod
-    def _parse_boolean_value(value, default) -> bool:
-        if not value:
-            return default
-        return value.lower() == 'true'
+    def _get_bool_header(value: Union[str, None], default: bool) -> bool:
+        """Parse a boolean header value.
+
+        https://httpwg.org/specs/rfc8941.html#boolean
+        """
+        return value == '?1' if value else default
 
     def _get_request_headers(self, headers: Union[dict, None]) -> RequestHeaders:
         if headers is None:
             headers = {}
         request_deadline = headers.get(JSONRPCHeaders.REQUEST_DEADLINE_HEADER)
         t0 = int(time())
         if request_deadline:
-            request_deadline = self._parse_number_value(request_deadline, 0, t0 + self._max_request_time, 0)
+            request_deadline = min(self._get_int_header(request_deadline, 0), t0 + self._max_request_time)
         else:
-            request_timeout = self._parse_number_value(
-                headers.get(JSONRPCHeaders.REQUEST_TIMEOUT_HEADER),
-                1,
-                self._max_request_time,
-                self._default_request_time,
+            request_timeout = headers.get(JSONRPCHeaders.REQUEST_TIMEOUT_HEADER)
+            request_timeout = min(
+                self._max_request_time, max(1, self._get_int_header(request_timeout, self._default_request_time))
             )
             request_deadline = t0 + request_timeout + 1
+        correlation_id = headers.get(JSONRPCHeaders.CORRELATION_ID_HEADER)
+        if not correlation_id:
+            correlation_id = b2a_hex(os.urandom(4)).decode()
         return RequestHeaders(
-            correlation_id=headers.get(JSONRPCHeaders.CORRELATION_ID_HEADER, b2a_hex(os.urandom(4)).decode()),
+            correlation_id=correlation_id,
             request_deadline=request_deadline,
-            abort_on_error=self._parse_boolean_value(headers.get(JSONRPCHeaders.ABORT_ON_ERROR), False),
+            abort_on_error=self._get_bool_header(headers.get(JSONRPCHeaders.ABORT_ON_ERROR), False),
+            use_template=self._get_bool_header(headers.get(JSONRPCHeaders.USE_TEMPLATE), False),
+            retries=min(10, max(0, self._get_int_header(headers.get(JSONRPCHeaders.RETRIES), 0))),
         )
 
     async def _execute_single(
         self,
-        coro,
+        f: Callable,
+        params: dict,
         request_id: _RequestId,
         body: dict,
+        retries: int,
         request_deadline: int,
         session: Optional[Session],
         correlation_id: Optional[str],
         callback: Callable[..., Awaitable],
     ) -> Tuple[dict, Union[RPCResponse, RPCError]]:
+        """Execute a single rpc request."""
         ctx = RequestContext(
             session_id=session.id if session else None,
             request_deadline=request_deadline,
             correlation_id=correlation_id,
         )
         REQUEST_SESSION.set(session)
         REQUEST_CONTEXT.set(ctx)
         try:
             async with timeout(request_deadline - time()):
-                result = await self._execute_request(coro, request_id, body)
+                result = await self._execute_request(f, params, retries, request_id, body)
         except asyncio.TimeoutError:
             result = RPCError(
                 id=request_id, error=RequestTimeout(message='Request timeout', request_deadline=request_deadline)
             )
         session = self.get_session()
         if self._sessions and session and session.stored and session.changed:
             await self._sessions.save_session(session)
@@ -393,52 +409,59 @@
             headers[JSONRPCHeaders.CORRELATION_ID_HEADER] = correlation_id
         if session and session.stored and (session.changed or session.loaded):
             headers[JSONRPCHeaders.SESSION_ID_HEADER] = session.id
         return headers
 
     async def _execute_batch(
         self,
-        requests: List[Tuple[_RequestId, Awaitable, dict]],
+        requests: List[Tuple[_RequestId, Callable, dict, dict]],
+        retries: int,
         request_deadline: int,
         abort_on_error: bool,
+        use_template: bool,
         session: Optional[Session],
         correlation_id: Optional[str],
         callback: Callable[..., Awaitable],
     ) -> Tuple[dict, List[Union[RPCResponse, RPCError]]]:
         """Execute multiple coroutine functions."""
         ctx = RequestContext(
             session_id=session.id if session else None,
             request_deadline=request_deadline,
             correlation_id=correlation_id,
         )
         REQUEST_SESSION.set(session)
         REQUEST_CONTEXT.set(ctx)
-        results = []
-        for n, (req_id, coro, body) in enumerate(requests):
+        results, template_ctx, req_id = [], {}, None
+        for n, (req_id, f, params, body) in enumerate(requests):
             try:
+                if use_template and n > 0:
+                    params = Template(params).fill(template_ctx)
                 async with timeout(request_deadline - time()):
-                    result = await self._execute_request(coro, req_id, body)
-                    if abort_on_error and isinstance(result, RPCError):
-                        raise _Aborted
-            except _Aborted:
-                results.extend(
-                    (RPCError(id=req_id, error=Aborted(message='Aborted')) for req_id, coro, body in requests[n:])
-                )
-                break
+                    result = await self._execute_request(f, params, retries, req_id, body)
+                if abort_on_error and isinstance(result, RPCError):
+                    raise _Aborted
+                if use_template and req_id is not None and type(result) is RPCResponse:
+                    template_ctx[str(req_id)] = result.result
             except asyncio.TimeoutError:
                 results.extend(
                     (
                         RPCError(
                             id=req_id,
                             error=RequestTimeout(message='Request timeout', request_deadline=request_deadline),
                         )
-                        for req_id, coro, body in requests[n:]
+                        for req_id, f, params, body in requests[n:]
                     )
                 )
                 break
+            except Exception as exc:
+                self.logger.error('Batch error', batch_num=n, request_id=req_id, exc_info=exc)
+                results.extend(
+                    (RPCError(id=req_id, error=Aborted(message='Aborted')) for req_id, f, params, body in requests[n:])
+                )
+                break
             else:
                 if result.id is not None or type(result) is not RPCResponse:
                     results.append(result)
         session = self.get_session()
         if self._sessions and session and session.stored and session.changed:
             await self._sessions.save_session(session)
         headers = self._get_response_headers(correlation_id, session)
@@ -446,15 +469,15 @@
             if callback:
                 cb = asyncio.create_task(callback(session, headers, results))  # noqa
                 cb.set_name(f'rpc:{correlation_id}:callback')
             return headers, results
 
     def _prepare_request(
         self, body, session: Optional[Session], scope: Scope, default_id: int
-    ) -> (_RequestId, Awaitable):
+    ) -> (_RequestId, Callable, dict, dict):
         """Pre-validate and prepare request for the execution."""
         # request body validation
         if type(body) is not dict:
             raise InvalidRequest(id=None, message='Request must be an object')
         if 'id' not in body:
             body['id'] = _id = default_id
         else:
@@ -494,36 +517,34 @@
                 raise InvalidParams(id=_id, message='Request "params" must be an object', request_params=params)
             if method['validator']:
                 try:
                     params = method['validator'](params)
                 except Exception as exc:
                     raise InvalidParams(id=_id, message=str(exc), base_exc=exc)
 
-        # coro construction
-
-        try:
-            coro = method['f'](**params)
-        except Exception as exc:
-            raise InvalidParams(id=_id, message=str(exc), base_exc=exc)
-        else:
-            return _RequestId(_id), coro, body
+        return _RequestId(_id), method['f'], params, body
 
     async def _execute_request(
         self,
-        coro: Awaitable,
+        f: Callable,
+        params: dict,
+        retries: int,
         request_id: _RequestId,
         request: dict,
     ) -> Union[RPCResponse, RPCError]:
         """Execute a coro and process an exception."""
         if self._request_logs:
             if not self._full_request_logs:
                 request['params'] = '...'
             self.logger.info('rpc accepted', request=request)
         try:
-            result = await coro
+            if retries:
+                result = await retry(f, kws=params, retries=retries, logger=self.logger)
+            else:
+                result = await f(**params)
             result = RPCResponse(id=request_id, result=result)
             _error = False
         except ClientError as exc:
             _error, result = True, exc
         except APIException as exc:
             _error, result = True, exc
             self.logger.error('Internal error', exc_info=exc)
```

## kaiju_tools/rpc/tests/fixtures.py

```diff
@@ -19,20 +19,23 @@
     app = application(debug=True)
     return JSONRPCServer(app=app, session_service=False, logger=logger)
 
 
 @pytest.fixture
 def rpc_compatible_service():
     class TestService(Service, AbstractRPCCompatible):
-
         service_name = 'm'
 
+        def __init__(self, *args, **kws):
+            super().__init__(*args, **kws)
+            self.retry_counter = 0
+
         @property
         def validators(self) -> dict:
-            return {'validated': j.Object({'a': j.Integer(), 'b': j.Integer()})}
+            return {'validated': j.Object({'a': j.Integer(), 'b': j.Integer()}, required=['a', 'b'])}
 
         @property
         def permissions(self) -> Optional[dict]:
             return {
                 '*': self.PermissionKeys.GLOBAL_GUEST_PERMISSION,
                 'method_with_user_permission': self.PermissionKeys.GLOBAL_USER_PERMISSION,
                 'method_with_user_permission_2': self.PermissionKeys.GLOBAL_USER_PERMISSION,
@@ -48,16 +51,24 @@
                 'long_echo': self.async_long_echo,
                 'split': self.split,
                 'standard_echo': self.async_standard_echo,
                 'validated': self.validated_method,
                 'uses_context': self.uses_context,
                 'method_with_user_permission': self.echo_true,
                 'method_with_user_permission_2': self.echo_true,
+                'method_with_retry': self.retry_method,
             }
 
+        async def retry_method(self, when: int) -> bool:
+            self.retry_counter += 1
+            if self.retry_counter < when:
+                raise TimeoutError('Simulated timeout')
+            self.retry_counter = 0
+            return True
+
         async def echo_true(self, *args, **kws):
             return True
 
         async def uses_context(self):
             """Check if a session matches the context."""
             return await self._uses_context()
```

## kaiju_tools/rpc/tests/test_rpc_server.py

```diff
@@ -98,42 +98,48 @@
         assert isinstance(response.error, InvalidParams)
 
         data = {'id': uuid4().int, 'method': 'm.validated', 'params': {'a': 11}}
         _headers, response = await rpc.call(data, {})
         logger.debug(response.repr())
         assert isinstance(response.error, InvalidParams)
 
-        logger.info('Testing multi requests.')
+        logger.info('Testing batch requests.')
 
         data = [
             {'id': uuid4().int, 'method': 'm.echo', 'params': {'x': True}},
             {'id': uuid4().int, 'method': 'm.echo', 'params': {'a': 1, 'b': 2}},
             {'id': uuid4().int, 'method': 'm.aecho', 'params': {'a': 1, 'b': 2}},
         ]
         _headers, response = await rpc.call(data, {})
         assert [r.result for r in response] == [((), {'x': True}), ((), {'a': 1, 'b': 2}), ((), {'a': 1, 'b': 2})]
 
+        logger.info('Testing batch requests using templates.')
+
+        data = [
+            {'id': 0, 'method': 'm.sum', 'params': {'x': 1, 'y': 1}},
+            {'id': 1, 'method': 'm.sum', 'params': {'x': 1, 'y': '[0]'}},
+            {'id': 2, 'method': 'm.sum', 'params': {'x': 1, 'y': '[1]'}},
+        ]
+        _headers, response = await rpc.call(data, {JSONRPCHeaders.USE_TEMPLATE: '?1'})
+        assert response[-1].result == 4
+
         logger.info('Testing request error handling.')
 
         data = {'id': uuid4().int, 'method': 'm.unknown', 'params': {'x': True}}
         _headers, response = await rpc.call(data, {})
         assert isinstance(response.error, MethodNotFound)
 
         data = {'id': uuid4().int}
         _headers, response = await rpc.call(data, {})
         assert isinstance(response.error, InvalidRequest)
 
         # data = {'id': uuid4().int, 'method': 'm.unknown', 'params': {'value': True}, 'shit': 1}
         # _headers, response = await rpc.call(data, {})
         # assert isinstance(response.error, InvalidRequest)
 
-        data = {'id': uuid4().int, 'method': 'm.sum', 'params': {'x': 1, 'z': '2'}}
-        _headers, response = await rpc.call(data, {})
-        assert isinstance(response.error, InvalidParams)
-
         data = {'id': uuid4().int, 'method': 'm.fail'}
         _headers, response = await rpc.call(data, {})
         assert isinstance(response.error, InternalError)
 
         logger.info('Testing timeouts.')
 
         headers = {}
@@ -144,14 +150,24 @@
         assert isinstance(response.error, RequestTimeout)
 
         data = {'id': uuid4().int, 'method': 'm.long_echo'}
         headers[JSONRPCHeaders.REQUEST_TIMEOUT_HEADER] = 10
         _headers, response = await rpc.call(data, headers)
         assert isinstance(response, RPCResponse)
 
+        logger.info('Testing retries.')
+
+        data = {'method': 'm.method_with_retry', 'params': {'when': 3}}
+        _headers, response = await rpc.call(data, {JSONRPCHeaders.RETRIES: 3})
+        assert response.result is True
+
+        data = {'method': 'm.method_with_retry', 'params': {'when': 3}}
+        _headers, response = await rpc.call(data, {JSONRPCHeaders.RETRIES: 1})
+        assert response.error
+
         logger.info('Testing for parallel task execution')
 
         tasks = []
 
         for _ in range(4):
             data = {'id': uuid4().int, 'method': 'm.standard_echo'}
             headers[JSONRPCHeaders.REQUEST_DEADLINE_HEADER] = int(time() + 1)
```

## kaiju_tools/tests/test_templates.py

```diff
@@ -7,14 +7,15 @@
     ['template', 'kws', 'result'],
     (
         ({'key': '`[value]`'}, {'value': 1}, {'key': '[value]'}),
         ({'key': '[value]'}, {'value': 1}, {'key': 1}),
         ({'key': '[[value]]'}, {'value': 'key_2', 'key_2': 0}, {'key': 0}),
         ({'key': ['[value]', '[value]']}, {'value': 1}, {'key': (1, 1)}),
         ({'key': '[value.nested]'}, {'value': {'nested': 1}}, {'key': 1}),
+        ({'key': '[value.nested:3]'}, {'value': [{'nested': 1}, {'nested': 2}, {}]}, {'key': [1, 2, 3]}),
         ({'key': '[!e:True]'}, {}, {'key': True}),
         ({'key': '[!e:[value]]'}, {'value': 'True'}, {'key': True}),
         ({'key': '[!f:{value}]'}, {'value': '123'}, {'key': '123'}),
         (
             {'key': '[!f:{obj-name} price is {obj-price}]'},
             {'obj': {'name': 'dog', 'price': 42}},
             {'key': 'dog price is 42'},
@@ -26,14 +27,15 @@
     ),
     ids=[
         'escaping',
         'ref: simple',
         'ref: nested ref',
         'ref: multiple',
         'ref: nested key',
+        'ref: nested key list',
         'eval: simple',
         'eval: by ref',
         'format: simple',
         'format: nested',
         'format: join args',
         'exec: simple',
         'exec: with args',
```

## Comparing `kaiju_tools-2.0.50.dist-info/LICENSE` & `kaiju_tools-2.0.51.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `kaiju_tools-2.0.50.dist-info/METADATA` & `kaiju_tools-2.0.51.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: kaiju-tools
-Version: 2.0.50
+Version: 2.0.51
 Summary: Base classes and services for a backend application.
 Home-page: https://gitlab.com/kaiju-python/kaiju-tools
 Author: antonnidhoggr@me.com
 Author-email: antonnidhoggr@me.com
 License: Apache Software License 2.0
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: Apache Software License
```

## Comparing `kaiju_tools-2.0.50.dist-info/RECORD` & `kaiju_tools-2.0.51.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -1,21 +1,21 @@
 kaiju_tools/CLI.py,sha256=JAggZ74FQZmu-Wr5vYzy0-dMB5zH3vQewDGe2lnW5eo,3424
-kaiju_tools/__init__.py,sha256=Lk9C0LaIBhSNK81MKMrnLDRJYUECmZmCX7Dy4gRF_Xo,228
+kaiju_tools/__init__.py,sha256=xO7ytIVaNJe4DRaS7dtpnlk64xGtGXf5yLs6EdoO3pY,228
 kaiju_tools/class_registry.py,sha256=sKn9YmblEeTBhcC_ivoGGTlBFXMG2G2WAsztdk1xBcE,7473
 kaiju_tools/exceptions.py,sha256=DJrtHxE3oWR9p7il2E8Q3r0P-JSKcDkwo57lcy74604,6013
 kaiju_tools/fixtures.py,sha256=h1ElRgENikjde-uXvk_exA_SvMPuxqtxo0qaiYDhCWk,997
-kaiju_tools/functions.py,sha256=LVxnviuH2wwif3TChnXOcNOR9WCWMnafqezV27pRBEc,8965
+kaiju_tools/functions.py,sha256=sF4stc_x1wROpj2b4mJUPYbEq3t1v0CT1hvZ9Hpuays,8940
 kaiju_tools/init_app.py,sha256=J5eDuiZqskrBWSjgM2d8CdsYkt28nqgrOLT4Ms8AZjg,2172
 kaiju_tools/jsonschema.py,sha256=piNO1KIQt4pdDezFz9CO8fGEBr91FFXhO94S92B0eAA,19143
 kaiju_tools/loop.py,sha256=Nkih75UgPen5SvZYSU0XFb9cbH6Zle-Nbto0B_wpn50,195
 kaiju_tools/mapping.py,sha256=JOloXn-etuB0EsaZ6spbZSDK3wlQ-vHIfkt2Za8-AzE,13521
 kaiju_tools/serialization.py,sha256=GHby_IRwIPVypPL4M76nBs_GjezMXU4wvZV6D9LhqNc,159
 kaiju_tools/services.py,sha256=xV4uVv-kH0ee6gtbWDvVdArq3xeJ1uKSSTejAX04Ayk,8221
 kaiju_tools/templates.py,sha256=6NGAT8RSDdvLYbnqqkHWCQ7LRY4K6eQg1vtEA5FFO34,14345
-kaiju_tools/ttl_dict.py,sha256=xdpqj1RgaatJFHE4rl3QMr5bnozu6HIG4jRkchgBxxM,4793
+kaiju_tools/ttl_dict.py,sha256=aAFgZN0c_y1oTvp-LYdn3FTpOyJHabJiLuZixOBZB1s,3442
 kaiju_tools/types.py,sha256=jCsHrgFYYm9FcZbYEOP-Jmba32IL4Rxq-7QaTsaN4So,3691
 kaiju_tools/cache/__init__.py,sha256=DOBTuvdFLJH4ZW6F-WeoDKg-jeP2R3MTqxSzRdTpfvc,2595
 kaiju_tools/cache/abc.py,sha256=WYE_dsx-zpJXPvlA1Azdws_ztvxJZD9ie7Yyeo3Q9D0,10481
 kaiju_tools/cache/local_cache.py,sha256=4EIGa6sVgE_DTpoGWxsxPKUQVE4zuuboiMPfbZePRos,2373
 kaiju_tools/cache/services.py,sha256=fOsRyLPCUL2i8Lb5rwVzCK7C808UIdG-scxYydgwjoE,43
 kaiju_tools/cache/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/cache/tests/test_cache.py,sha256=y0r_F8VxVNDbtWkrPmRGLslN8ySPGYKw3h4t-UqCJl0,2315
@@ -32,17 +32,17 @@
 kaiju_tools/docker/stack.py,sha256=7OwZPpuL0nFMQC-8B1bJXCm8qVNP3tGd0mv0XdhwwbA,11140
 kaiju_tools/docker/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/docker/tests/fixtures.py,sha256=0bx6BE7id5Rz52y3nEVXx0ZNjzPuDe_T9C6Jzq4iHaU,1625
 kaiju_tools/docker/tests/test_containers.py,sha256=Yugtil6wQs2DGp6W0lNJM0ZoihzG5d95z0u5StGIfJ0,575
 kaiju_tools/docker/tests/test_images.py,sha256=XDJ1Z3XQSQswiJxDO_QtKmw4NymJpXhSdvHtxCGg8rE,359
 kaiju_tools/docker/tests/test_stack.py,sha256=qa6UbjCBiVmAORKyWTs9HaArZF0ZLBDZSzGJlc3Bjhs,371
 kaiju_tools/encoding/__init__.py,sha256=hLMiGsFxCgusvfnq4MOPgI3jMGezZyU_KvE9qn80W3s,65
-kaiju_tools/encoding/abc.py,sha256=QaHLzs7PfS35wL26V_RCMId3v7DQq6k5J91t7DEdW1Y,2996
+kaiju_tools/encoding/abc.py,sha256=mk4iqXonaiULy7lK3a0iA1Q_Wpgs4qEmd7s2EZ81utw,3012
 kaiju_tools/encoding/etc.py,sha256=8YKb6OZrb0is64xlvGkowUR2b_ivnzsW1IhZoMv8a3g,163
-kaiju_tools/encoding/json.py,sha256=A_8vr6cwsnoUGd6PkCEKbgd5jIjyk9-3aKIh--O02jQ,4457
+kaiju_tools/encoding/json.py,sha256=xvPcEPuaVmDXugNzT2Kqb_ZBXyRpbaElKuE2pVGjP98,4456
 kaiju_tools/encoding/msgpack.py,sha256=cjAuhmtYtiemMSlq9DG6dT2gP048b1Q8cEyMjcvMKtk,4284
 kaiju_tools/encoding/serializers.py,sha256=EXcSZAsrEU3OPGJkGfCVKDVZ8KZNxfDYb2-hPAOMbbM,654
 kaiju_tools/encoding/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/encoding/tests/fixtures.py,sha256=9PC1mnDN0JLzHZU6Vg9x2p0uDcw3ASM-g_v5vJITu-c,780
 kaiju_tools/encoding/tests/test_serializers.py,sha256=ntdV6dihmwZNjzQiRm_xXoXhNAZzz6rGVbFTFSkAGnE,1054
 kaiju_tools/es/__init__.py,sha256=_lGbw9UADok07fqeMvLlZGHefDsJ7wppstJ8qkME_9k,46
 kaiju_tools/es/client.py,sha256=UBxzJsl71d6bZH96p-BAGX9SSEj3aedZpLXvGyA-sjk,18302
@@ -69,34 +69,34 @@
 kaiju_tools/logging/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/logging/tests/test_loggers.py,sha256=byzlYqRVN7l6ZJ5Ph9_d4tjJx8MyDD75LnCBd_av4jo,1827
 kaiju_tools/rpc/__init__.py,sha256=1_nq0D65USGIS2jXxF_88fR-LfaiXXF-PqNBTlpkWkg,43
 kaiju_tools/rpc/abc.py,sha256=XfmsF66rP3wvW0_LGPx3JpU4NF_NWqNZg-DLDBb8Nzw,11883
 kaiju_tools/rpc/client.py,sha256=mjbdx2kL2ZWuG6cLFfeLw4eygsX0LI6Ax6SqL3xNjOw,5111
 kaiju_tools/rpc/client_gen.py,sha256=pL3afEvDJIlD5SorfEtSj64Ef5JolYLTkVYPs3fpohw,3825
 kaiju_tools/rpc/context.py,sha256=l27TATs8IKs4f_690JRn75WY7TsjXWInDgqUrCP03FU,116
-kaiju_tools/rpc/etc.py,sha256=rUByIq3pv6hQektlthEeyWrRjloWPLuokNMK7frWZ9k,544
+kaiju_tools/rpc/etc.py,sha256=KkbYgTjWG8V1bhi8co2UrAjpUuHtYYYKpRBEe4hil9I,591
 kaiju_tools/rpc/jsonrpc.py,sha256=m1PUr-0j_2fPs5sxk8p-DQqipJefJG9SDKoh3cJBSJg,2943
-kaiju_tools/rpc/server.py,sha256=4qBJUj0BJmIdT-_xrcTkj_GCcpFZNo_1hXZsGTZT_R8,21814
+kaiju_tools/rpc/server.py,sha256=CtFTSa9bqYuMVcyg_1_2omKS8SopjHgpnOHg-l9m2YA,23056
 kaiju_tools/rpc/services.py,sha256=FgR7DpZTKjYBx7ieXKHkh4Lqrqe910c_iAiKxTOcdIk,71
 kaiju_tools/rpc/sessions.py,sha256=cSXssImSl2Wl8JmjITibpdSMqdUFap7dqKWS52MOCug,6259
 kaiju_tools/rpc/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-kaiju_tools/rpc/tests/fixtures.py,sha256=6NUdBeZA3a_vrRe5oLTyDGU3FCqD5JwqZlXd1xFpsb8,4207
-kaiju_tools/rpc/tests/test_rpc_server.py,sha256=3iuyAw4N9HHUe7qMfVtD6k5XyCrBW0YVadsWq7CMbBI,7845
+kaiju_tools/rpc/tests/fixtures.py,sha256=u6tsJbyn_WDQtDeKLbp3V2WvAaV2E9YD6VvrnSQ6lHU,4655
+kaiju_tools/rpc/tests/test_rpc_server.py,sha256=UkEBes0uNDpqfuduvSldIx_yYa6UsE9Py4HL-CNRPrc,8500
 kaiju_tools/streams/__init__.py,sha256=pHOdZ9DDYEMdr3EjCBCuNqYGY1hLqWwTU2v64vPCHP4,38
 kaiju_tools/streams/abc.py,sha256=wKOKU3pfmb9dNLdcHZomPFaGvgGPDXMq6F-PG3rr5gk,24578
 kaiju_tools/streams/etc.py,sha256=xAaOal-vRdGluvVOL698eY7TdpV-lboqH39DEFWeP5c,152
 kaiju_tools/streams/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/streams/tests/fixtures.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/streams/tests/test_streams.py,sha256=xB-Dv5RppQMi66U-aZ1IdfJ147ZDdpjM-nCrAjJCdP4,5975
 kaiju_tools/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kaiju_tools/tests/fixtures.py,sha256=k1Ou6JiYt4XM4-6zMVzO23fPyD4yFslrF3gbbwl6SlU,2016
 kaiju_tools/tests/test_class_registry.py,sha256=D9mZu9sgY21gEWE8vp2HN0Vfb5WZqxWTNVRPWEPduhU,1408
 kaiju_tools/tests/test_mapping.py,sha256=HzxgQo-k2cBPE88F4AnhBv_Ixb0YS-dWL5rQtM_MRVE,3385
 kaiju_tools/tests/test_serialization.py,sha256=9ETlE5i8b2WFwKsTrECVuB14Pkxf4QgCc6oFX_yjMZw,481
 kaiju_tools/tests/test_services.py,sha256=fYhWYsp-aAyIYwAcLx0ScZhBLBPEX6Apf2LRVWe-WX8,2787
-kaiju_tools/tests/test_templates.py,sha256=XQfGPY1FEIUhZZg4DZQYGTS887xFlPEfyQf0USjJYOw,1554
+kaiju_tools/tests/test_templates.py,sha256=CoQdRatGZhGzPl_y4MYXPTQMA9c_wn0ieVITQaamrL4,1692
 kaiju_tools/tests/test_ttl_dict.py,sha256=HWuoDepQdEWixOBlYhCzR1RVLHz20jXwa4SWrrr0A7o,796
-kaiju_tools-2.0.50.dist-info/LICENSE,sha256=XIlN2qA8UqpBDA-PteoYP4hTU0qBW0G9PRB__khO2zc,610
-kaiju_tools-2.0.50.dist-info/METADATA,sha256=84NCEZdg8M3QNnrN4QwkQlhRCbPflGBOm71ZiXlAYYc,3258
-kaiju_tools-2.0.50.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-kaiju_tools-2.0.50.dist-info/top_level.txt,sha256=DIgXUScFnJtRLiRWfjo547JK4rMuTIJoioMPRe1Jn6Y,12
-kaiju_tools-2.0.50.dist-info/RECORD,,
+kaiju_tools-2.0.51.dist-info/LICENSE,sha256=XIlN2qA8UqpBDA-PteoYP4hTU0qBW0G9PRB__khO2zc,610
+kaiju_tools-2.0.51.dist-info/METADATA,sha256=GZ0vPuOuXRyBZ4JsaZb9OLeOXzyT4NtQ9PFT2vNhQhQ,3258
+kaiju_tools-2.0.51.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+kaiju_tools-2.0.51.dist-info/top_level.txt,sha256=DIgXUScFnJtRLiRWfjo547JK4rMuTIJoioMPRe1Jn6Y,12
+kaiju_tools-2.0.51.dist-info/RECORD,,
```

